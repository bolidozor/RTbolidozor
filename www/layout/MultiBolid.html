 <!DOCTYPE html>
<html>
{% import datetime %}
{% import math %}
  <head>
    <title>{% block title %}Default title{% end %}</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="MB.css">
    <link type="text/css" rel="stylesheet" href="http://space.astro.cz/bolidozor/support/js9browser/js9support.css">
    <link type="text/css" rel="stylesheet" href="http://space.astro.cz/bolidozor/support/js9browser/js9.css">
    <script type="text/javascript" src="http://space.astro.cz/bolidozor/support/js9browser/js9support.min.js"></script>
    <script type="text/javascript" src="http://js9.si.edu/js9/js9.min.js"></script>
    <script type="text/javascript" src="http://js9.si.edu/js9/js9plugins.js"></script>
    <script type="text/javascript">
        function Open(args) {
            JS9.Load.apply(this, arguments)
            document.getElementById("window").style.display = 'block';
        }
        function Close() {
            document.getElementById("window").style.display = 'none';
        }
    </script>
  </head>
  <body>    
    <div id="header">
        <img src="http://space.astro.cz/bolidozor/support/js9browser/header_logo.png"></img>
        {{ "multi-station bolid database" }}
    </div>
    <div class="container">
    <div class="parameters">
        <form style="margin: 0px; padding: 0px; display: in-line; max-width: 90%;">
            Month: <input type="month" name="month" value="{{parent.get_argument('month', str(datetime.datetime.utcnow().strftime('%Y-%m')))}}">
            <input type="submit">
        </form>
    </div>
    {% if 0 %} 
        <div class="parameters" id="error">
        Error: 0 výsledků ... Zkus jiný datum {{len(data[0])}}
        </div>
    {% else %}

        <div class="parameters" id="error">
            Error: None result   --- testovaci chyba :) 
        </div>
        
        {% set event_n = 0 %}
        {% for event_group in _sql("SELECT * FROM meta WHERE link != 0 AND time > "+str(range[0])+" AND time < "+str(range[1])+" GROUP BY link ORDER BY time DESC ;") %}<!-- META - 0 id, 1 time, 2 id_station, 3 noise, 4 freq, 5 mag, 6 duration, 7 file , 8 link, 9 met_true, 10 met_false, 11 met_head --> 
            {% set time_first = float(event_group[1])%}
            {% set links = _sql("SELECT metalink.link, meta.time, meta.file FROM metalink LEFT JOIN meta ON meta.id = metalink.link WHERE metalink.master = "+str(event_group[0])+" GROUP BY metalink.link; ") %}
            <div class="event_group" id="{{event_group[8]}}">
                <span class="eventGroupCell"> # {{ event_n = event_n + 1 }} <span style="font-size: xx-small">event_group: {{event_group[8] }}</span></span>
                <span class="eventGroupCell">{{ datetime.datetime.fromtimestamp(event_group[1]).strftime('%Y-%m-%d %X')}} </span>

            </div>
            <table class="eventListTable" id="{{event_group[8]}}" style="width:100%">
                <tr style="text-align: center; font-size: x-small; top: -5px;"><td>Date</td><td>Station</td><td>noise</td><td>freq</td><td>mag</td><td>duration</td><td>link</td></tr>

            {% for event in links %}
                <tr> <div class="event_list">
                    <td><span class="eventCell"> {{datetime.datetime.fromtimestamp(event[1]).strftime('%Y-%m-%d %X')}} &#916 {{round(event[0]-0)}}s</span></td>
                    <td><span class="eventCell"> {{event[0]}}</span></td>
                    <td><span class="eventCell"> {{float(event[0])}}</span></td>
                    <td><span class="eventCell"> {{float(event[0])}}</span></td>
                    <td><span class="eventCell"> {{float(event[0])}}</span></td>
                    <td><span class="eventCell"> {{event[0]}}</span></td>
                    <td><span class="eventCell">
                </div></tr>

            {% end %}
    {% end %}
        </table>

    {% end %}
    </div>
    <div id="foot">
        Foot

    </div>

    <div id="window">
        <div><a href="javascript:Close();">                       X</a></div>
        <div class="JS9Menubar"></div>
        <div class="JS9"></div>
    </div>

    </body>
</html>
